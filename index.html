<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aplikasi PAUD â€” Jati Diri (Responsive)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --orange:#FFA726; --yellow:#FFD54F; --green:#81C784; --blue:#4FC3F7;
      --card:#FFFDE7; --muted:#666; --radius:18px; --glass: rgba(255,255,255,0.6);
      --shadow: 0 8px 30px rgba(0,0,0,0.08);
      --bg-start: #FFFDE7;
    }
    *{box-sizing:border-box}
    body{font-family: 'Poppins', 'Noto Sans', Arial, sans-serif; margin:0; background: linear-gradient(135deg,var(--yellow),var(--orange)); color:#222; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

    /* layout */
    .app{display:flex;gap:20px;max-width:1200px;margin:24px auto;padding:12px;align-items:flex-start}
    aside.sidebar{width:280px;background:linear-gradient(180deg,var(--blue),var(--green));padding:18px;border-radius:14px;color:#fff;box-shadow:0 10px 40px rgba(0,0,0,0.12);height:calc(100vh - 48px);position:sticky;top:24px;overflow:auto;transition:transform .25s ease}
    aside.sidebar.hidden{transform:translateY(-12px);opacity:0;pointer-events:none}
    main{flex:1;min-width:0}

    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:20px;margin:0}
    .menu{list-style:none;padding:12px 0;margin:14px 0}
    .menu li{padding:10px;border-radius:12px;display:flex;align-items:center;gap:10px;cursor:pointer;transition:all .18s}
    .menu li:hover{background:rgba(255,255,255,0.08); transform: translateX(6px);}
    .menu li.active{background:rgba(255,255,255,0.12);font-weight:700}

    .content{padding:8px}
    .card{background:var(--card);border-radius:var(--radius);padding:22px;margin-bottom:18px;box-shadow:var(--shadow);border-left:8px solid var(--orange); animation:fadeIn .36s ease}
    .page-title{color:var(--orange);font-size:26px;margin-bottom:6px}
    p{line-height:1.7;color:#222}
    h3{color:var(--orange)}

    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:linear-gradient(135deg,var(--orange),#FB8C00);color:#fff;padding:10px 16px;border-radius:28px;border:none;cursor:pointer;font-weight:700;box-shadow:0 8px 20px rgba(255,167,38,0.25);transition:transform .12s, opacity .12s}
    .btn:active{transform:translateY(2px)}
    .btn.secondary{background:linear-gradient(135deg,var(--blue),#29B6F6)}
    .btn.ghost{background:transparent;border:2px solid rgba(255,255,255,0.18);box-shadow:none}

    .summary{background:linear-gradient(135deg,#FFF9C4,#fff);padding:14px;border-radius:12px;border:2px solid var(--yellow);margin:12px 0}

    /* quiz */
    .quiz-option{background:#fff;padding:12px;border-radius:12px;margin-bottom:8px;cursor:pointer;border:2px solid transparent;transition:transform .12s, background .12s, opacity .12s}
    .quiz-option:hover{transform:translateX(6px);border-color:var(--yellow);background:#FFFDE7}
    .quiz-option.correct{background:#C8E6C9;border-color:#66BB6A}
    .quiz-option.wrong{background:#FFCDD2;border-color:#EF5350}

    /* drag & drop Desktop */
    .dnd-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:12px}
    .dnd-item{background:#fff;border-radius:10px;padding:12px;text-align:center;cursor:grab;border:2px dashed transparent;box-shadow:0 6px 18px rgba(0,0,0,0.06);transition:transform .12s, opacity .12s}
    .dnd-item:active{transform:scale(.98)}
    .dnd-item.used{opacity:0.4; cursor:not-allowed; pointer-events:none; border-style:solid; border-color:#e0e0e0}
    .dnd-target{background:rgba(255,255,255,0.85);min-height:80px;border-radius:10px;padding:8px;display:flex;align-items:center;justify-content:center;border:2px dashed #eee;transition:border-color .12s, background .12s; text-align:center}
    .dnd-target.filled{border-color:#66bb6a;background:rgba(198,239,206,0.6)}
    .dnd-target.wrong{border-color:#ef5350;background:rgba(255,205,210,0.35)}

    /* matching cards */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:12px}
    .card-front{background:#fff;padding:12px;border-radius:12px;text-align:center;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.06);transition:transform .12s, border .12s;}
    .card-front.matched{opacity:.45; transform:scale(.98); border:2px solid var(--green); pointer-events:none}
    .card-front.selected{border:2px solid var(--yellow); transform:scale(1.04)}

    /* mobile */
    @media (max-width:920px){
      .app{flex-direction:column;padding:0 8px}
      .sidebar{width:100%;height:auto;border-radius:12px;position:relative;top:0}
      .menu li{border-radius:8px}
      .desktop-only{display:none}
      #mobileMenuBtn{display:block}
    }
    @media (min-width:921px){
      #mobileMenuBtn{display:none}
      .mobile-only{display:none}
    }

    footer{margin-top:8px;font-size:13px;color:var(--muted)}

    /* playful small helper */
    .small-note{font-size:13px;color:#555;margin-top:8px}
    .result-badge{padding:10px;border-radius:12px;background:#E8F5E9;border:2px solid #C8E6C9;display:inline-block}

    /* animations */
    @keyframes fadeIn { from {opacity:0; transform: translateY(6px)} to {opacity:1; transform:none} }
    .pop { animation: pop .36s ease; }
    @keyframes pop { 0%{transform:scale(.96); opacity:0} 60%{transform:scale(1.04); opacity:1} 100%{transform:scale(1); opacity:1} }

    /* accessible focus */
    .quiz-option:focus, .card-front:focus, .dnd-item:focus { outline:3px solid rgba(255,200,60,0.28); outline-offset:4px; }

    @media (max-width: 920px) {
  aside.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 260px;
    height: 100vh;
    z-index: 9999;
    background: linear-gradient(180deg,var(--blue),var(--green));
    transform: translateX(-100%);
    transition: transform .3s ease;
  }
  aside.sidebar.active {
    transform: translateX(0);
  }
  .app {
    padding: 0;
  }
}


  </style>
</head>
<body>
  <div style="max-width:1200px;margin:8px auto;padding:0 12px;">
    <button id="mobileMenuBtn" class="btn secondary mobile-only" style="width:100%;margin-bottom:8px" onclick="toggleMobileSidebar()"><i class="fa-solid fa-bars"></i> Menu</button>
  </div>

  <div class="app" role="application" aria-label="Aplikasi PAUD Jati Diri">
    <aside class="sidebar" role="navigation" id="sidebar">
      <div class="brand">
        <div style="font-size:34px;">ðŸ‘§ðŸ§’</div>
        <div>
          <h1>Panduan PAUD â€” Jati Diri</h1>
          <div style="font-size:13px;opacity:0.95">Ringkasan dan aktivitas interaktif</div>
        </div>
      </div>

      <ul class="menu" id="menu">
        <li class="active" data-target="overview"><i class="fa-solid fa-house"></i> Beranda</li>
        <li data-target="bab1"><i class="fa-solid fa-book-open-reader"></i> Bab 1 (Ringkas)</li>
        <li data-target="bab2"><i class="fa-solid fa-layer-group"></i> Bab 2 (Ringkasan)</li>
        <li data-target="bab3"><i class="fa-solid fa-school"></i> Bab 3 (Ringkasan)</li>
        <li data-target="quiz"><i class="fa-solid fa-question"></i> Quiz</li>
        <li data-target="interactive"><i class="fa-solid fa-gamepad"></i> Latihan Interaktif</li>
        <li data-target="download"><i class="fa-solid fa-download"></i> Unduh Materi (PDF)</li>
      </ul>

      <div style="margin-top:16px;font-size:13px;line-height:1.4">
        <div><strong>Palet PAUD:</strong></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="width:28px;height:20px;background:var(--orange);border-radius:6px"></div>
          <div style="width:28px;height:20px;background:var(--yellow);border-radius:6px"></div>
          <div style="width:28px;height:20px;background:var(--green);border-radius:6px"></div>
          <div style="width:28px;height:20px;background:var(--blue);border-radius:6px"></div>
        </div>
      </div>

      <footer>
        <div style="margin-top:14px">Sumber asli: <br><a href="/mnt/data/Jati_diri_BG_Paud.pdf" style="color:#fff;text-decoration:underline">Jati_diri_BG_Paud.pdf</a></div>
        <div style="margin-top:8px">(Konten diringkas dari file PDF yang diunggah)</div>
      </footer>
    </aside>

    <main class="content" id="main">

      <!-- Overview -->
      <section id="overview" class="card section">
        <div class="page-title">Selamat datang â€” Aplikasi Jati Diri PAUD</div>
        <p>Ini adalah versi ringkas dan interaktif dari <strong>Panduan Guru: Jati Diri untuk PAUD (Edisi Revisi)</strong>. Semua materi Bab 1 ditampilkan ringkas dan akurat sesuai PDF. Bab 2 dan 3 juga diringkas sebagai rangkuman singkat â€” kamu bisa memperluas nanti.</p>
        <div class="summary">
          <strong>Petunjuk cepat:</strong>
          <ul>
            <li>Pilih menu di sebelah kiri (atau tombol Menu di perangkat mobile) untuk membuka Bab, Quiz, atau Latihan Interaktif.</li>
            <li>Gunakan tombol <em>Play</em> untuk narasi suara, dan fitur drag & drop untuk latihan. Di mobile drag&drop beralih ke tap-based agar kompatibel dengan APK/WebView.</li>
            <li>Sumber dokumen: <em>/mnt/data/Jati_diri_BG_Paud.pdf</em>.</li>
          </ul>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn" onclick="playAudio('intro')"><i class="fa-solid fa-play"></i> Mainkan Penjelasan Suara</button>
          <button class="btn secondary" onclick="downloadPDF()"><i class="fa-solid fa-file-arrow-down"></i> Unduh PDF Sumber</button>
          <button class="btn ghost" onclick="toggleTheme()"><i class="fa-solid fa-adjust"></i> Mode Cerah/Gelap</button>
        </div>
      </section>

      <!-- Bab 1 -->
      <section id="bab1" class="card section" style="display:none">
        <div class="page-title">Bab 1 â€” Membangun Jati Diri pada Anak Usia Dini</div>
        <p><em>Ringkasan inti Bab 1 (diambil langsung dari file PDF dan diringkas):</em></p>

        <h3>A. Pengertian Jati Diri</h3>
        <p>Jati diri merupakan pemahaman anak tentang dirinya â€” identitas, kemampuan, kesukaan, dan perannya dalam keluarga, sekolah, dan masyarakat. Pembentukan jati diri bersifat holistik, melibatkan nilai, pengetahuan, keterampilan, emosi, dan fungsi gerak anak. (Sumber: PDF.)</p>

        <h3>B. Pentingnya Jati Diri Positif</h3>
        <p>Membangun jati diri positif membantu anak: 1) tumbuh percaya diri, 2) memiliki perilaku sosial yang sehat, 3) siap untuk proses pembelajaran berikutnya. Jati diri positif memudahkan anak menyesuaikan diri dengan aturan dan norma setempat.</p>

        <h3>C. Proses Pembentukan</h3>
        <ol>
          <li><strong>Pengenalan diri:</strong> nama, usia, ciri fisik, kemampuan yang dimiliki.</li>
          <li><strong>Eksplorasi:</strong> kegiatan motorik & kognitif untuk mengetahui kemampuan.</li>
          <li><strong>Interaksi sosial:</strong> belajar aturan, norma, dan peran sosial.</li>
          <li><strong>Pengelolaan emosi:</strong> mengenal & mengekspresikan perasaan secara tepat.</li>
          <li><strong>Integrasi nilai:</strong> identitas budaya, agama, dan kebangsaan.</li>
        </ol>

        <div class="summary">
          <strong>Catatan:</strong> Bab 1 pada PDF juga menyertakan contoh kejadian, indikator ketercapaian, dan panduan praktis untuk guru. Jika ingin detail tabel indikator atau contoh alur tujuan pembelajaran, minta saja.
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn" onclick="playAudio('bab1')"><i class="fa-solid fa-play"></i> Baca Ringkasan Bab 1</button>
        </div>
      </section>

      <!-- Bab 2 -->
      <section id="bab2" class="card section" style="display:none">
        <div class="page-title">Bab 2 â€” Mengenal Elemen dan Subelemen Jati Diri (Ringkasan)</div>
        <p>Bab 2 menjabarkan elemen jati diri secara lebih rinci: enam kemampuan fondasi, subelemen, contoh kejadian, indikator yang teramati, dan cara membangun konsep pengetahuan/nilai jati diri di PAUD. Intinya: guru diberi panduan praktis untuk mengobservasi dan merancang kegiatan.</p>
      </section>

      <!-- Bab 3 -->
      <section id="bab3" class="card section" style="display:none">
        <div class="page-title">Bab 3 â€” Merancang Pembelajaran (Ringkasan)</div>
        <p>Bab 3 berisi langkah-langkah merancang pembelajaran yang menguatkan jati diri: perencanaan, pelaksanaan, refleksi, pilihan alat & cara mengajar, serta contoh asesmen autentik berupa ceklis, catatan anekdot, dan dokumentasi karya.</p>
      </section>

      <!-- Quiz -->
      <section id="quiz" class="card section" style="display:none">
        <div class="page-title">Quiz Ringkas â€” Bab 1</div>
        <p>Pilih jawaban yang menurutmu benar. Soal diambil dan diringkas dari Bab 1 (PDF).</p>

        <div id="quiz-area" aria-live="polite"></div>
        <div style="margin-top:12px;display:flex;gap:10px">
          <button class="btn" id="checkBtn" onclick="checkAnswers()"><i class="fa-solid fa-check"></i> Cek Jawaban</button>
          <button class="btn secondary" onclick="resetQuiz()"><i class="fa-solid fa-rotate"></i> Ulangi</button>
        </div>
        <div id="quiz-result" style="margin-top:12px"></div>
      </section>

      <!-- Interactive -->
      <section id="interactive" class="card section" style="display:none">
        <div class="page-title">Latihan Interaktif</div>
        <p>Berbagai aktivitas interaktif singkat untuk anak PAUD (diringkas dari saran kegiatan di PDF). Mode desktop menggunakan drag & drop asli; mobile / WebView memakai tap-based fallback.</p>

        <!-- controls -->
        <div style="margin:12px 0; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <button class="btn" onclick="checkInteractive()"><i class="fa-solid fa-check"></i> Cek Jawaban</button>
          <button class="btn secondary" onclick="resetInteractive()"><i class="fa-solid fa-rotate"></i> Reset Latihan</button>
          <div class="small-note">(Drag & Drop desktop, Tap fallback mobile; Cocokkan Kartu, dan Pilih Emosi)</div>
        </div>

        <h3>1) Drag & Drop â€” Cocokkan</h3>
        <p>Tarik kata ke kotak yang tepat (desktop). Di mobile, ketuk item lalu ketuk kotak tujuan.</p>
        <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1; min-width:220px">
            <div id="dnd-pool" class="dnd-grid" style="padding:12px;background:rgba(255,255,255,0.9);border-radius:12px;border:2px dashed rgba(0,0,0,0.04);">
              <div class="dnd-item" draggable="true" data-id="nama" tabindex="0">Nama</div>
              <div class="dnd-item" draggable="true" data-id="umur" tabindex="0">Umur</div>
              <div class="dnd-item" draggable="true" data-id="kesukaan" tabindex="0">Kesukaan</div>
              <div class="dnd-item" draggable="true" data-id="kemampuan" tabindex="0">Kemampuan</div>
            </div>
            <div class="small-note">Tarik salah satu kartu (desktop), atau ketuk kartu lalu ketuk kotak (mobile).</div>
          </div>

          <div style="flex:1; min-width:260px; display:flex; flex-direction:column; gap:10px;">
            <div class="dnd-target" data-accept="nama" aria-label="target siapa">Sebutkan <strong>siapa</strong> kamu</div>
            <div class="dnd-target" data-accept="umur" aria-label="target umur">Sebutkan <strong>berapa</strong> usiamu</div>
            <div class="dnd-target" data-accept="kesukaan" aria-label="target suka">Sebutkan <strong>yang kamu suka</strong></div>
            <div class="dnd-target" data-accept="kemampuan" aria-label="target kemampuan">Sebutkan <strong>yang bisa kamu lakukan</strong></div>
          </div>
        </div>

        <h3 style="margin-top:16px">2) Matching Cards â€” Cocokkan gambar & kata</h3>
        <p>Klik satu kartu, lalu klik pasangan yang cocok (desktop). Di mobile, ketuk untuk memilih lalu ketuk pasangan.</p>
        <div class="cards" id="match-cards" role="list">
          <!-- Pair "anak": emoji and word -->
          <div class="card-front" data-pair="anak" data-original="ðŸ§’ Anak" tabindex="0">ðŸ§’<div>Emoji: Anak</div></div>
          <div class="card-front" data-pair="anak" data-original="Anak" tabindex="0">Anak<div style="font-size:10px;color:#777">Kata</div></div>

          <!-- Pair "bola": emoji and word -->
          <div class="card-front" data-pair="bola" data-original="âš½ Bola" tabindex="0">âš½<div>Emoji: Bola</div></div>
          <div class="card-front" data-pair="bola" data-original="Bola" tabindex="0">Bola<div style="font-size:10px;color:#777">Kata</div></div>
        </div>

        <h3 style="margin-top:16px">3) Pilih Emosi yang Tepat</h3>
        <p>Tunjukkan emotikon yang sesuai dengan situasi:</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="selectEmoji('ðŸ˜Š')">ðŸ˜Š Senang</button>
          <button class="btn secondary" onclick="selectEmoji('ðŸ˜¢')">ðŸ˜¢ Sedih</button>
          <button class="btn" onclick="selectEmoji('ðŸ˜¡')">ðŸ˜¡ Marah</button>
        </div>

        <div id="interactive-result" style="margin-top:12px;color:var(--muted)"></div>
      </section>

      <!-- Download -->
      <section id="download" class="card section" style="display:none">
        <div class="page-title">Unduh Materi</div>
        <p>Kamu bisa mengunduh file sumber PDF yang kamu upload (digunakan sebagai referensi).</p>
        <div style="display:flex;gap:10px">
          <a class="btn" href="/mnt/data/Jati_diri_BG_Paud.pdf" download><i class="fa-solid fa-file-pdf"></i> Unduh PDF Sumber</a>
          <button class="btn secondary" onclick="exportHTML()"><i class="fa-solid fa-file-code"></i> Ekspor Halaman ini (.html)</button>
        </div>
      </section>

    </main>
  </div>

  <!-- Script: logic interaktif + quiz + audio + adaptasi mobile -->
  <script>
    /* -------------------------
       Data: quiz derived from PDF
       ------------------------- */
    const quizData = [
      {q: 'Apa yang dimaksud jati diri?', options: ['Pemahaman tentang diri', 'Permainan', 'Makanan', 'Angka'], a:0},
      {q: 'Salah satu fungsi pembentukan jati diri adalah...', options: ['Meningkatkan percaya diri','Membuat malas','Membuat lapar','Membuat bingung'], a:0},
      {q: 'Contoh pengelolaan emosi pada anak?', options: ['Menunjukkan perasaan tepat','Berteriak terus','Diam saja selamanya','Mencuri'], a:0},
      {q: 'Fungsi gerak yang digunakan untuk mengeksplorasi disebut?', options: ['Motorik', 'Matematika','Bahasa','Seni'], a:0},
      {q: 'Elemen jati diri TIDAK termasuk...', options: ['Makanan favorit saja','Identitas','Emosi','Motorik'], a:0},
      {q: 'Asesmen PAUD sebaiknya bersifat...', options: ['Autentik','Sangat formal','Hanya tertulis','Sangat teoretis'], a:0},
      {q: 'Siapa yang harus menyesuaikan pembelajaran dengan konteks lokal?', options: ['Pendidik','Anak saja','Komputer','Buku saja'], a:0},
      {q: 'Salah satu tujuan pembelajaran jati diri adalah...', options: ['Anak mengenal identitas dan perannya','Menjadikan anak dewasa','Menghapus emosi','Membuat anak bekerja'], a:0}
    ];

    // UI wiring for sidebar/menu
    document.querySelectorAll('.menu li').forEach(li => li.addEventListener('click', ()=> {
      document.querySelectorAll('.menu li').forEach(x=>x.classList.remove('active'));
      li.classList.add('active');
      showSection(li.dataset.target);
      // close mobile sidebar if open
      if(window.innerWidth <= 920) document.getElementById('sidebar').classList.remove('active');
    }));

    function showSection(id){
      document.querySelectorAll('.section').forEach(s=>s.style.display='none');
      const el = document.getElementById(id);
      if(el) el.style.display = 'block';
      if(id==='quiz') renderQuiz();
      if(id==='interactive') {
        // ensure interactive widgets ready
        setTimeout(()=> {
          initDragDrop();
          initMatching();
        }, 10);
      }
    }

    function toggleMobileSidebar(){
  document.getElementById('sidebar').classList.toggle('active');
}


    // mobile menu toggle
    function toggleMobileSidebar(){
      document.getElementById('sidebar').classList.toggle('active');
    }

    // theme toggle (simple inversion)
    let dark=false;
    function toggleTheme(){
      dark = !dark;
      if(dark){
        document.body.style.filter = 'invert(0.03) hue-rotate(10deg)';
      } else {
        document.body.style.filter = 'none';
      }
    }

    /* --- Quiz functions --- */
    let userAnswers = Array(quizData.length).fill(null);
    function renderQuiz(){
      const area = document.getElementById('quiz-area'); area.innerHTML='';
      quizData.forEach((q, idx)=>{
        const card = document.createElement('div'); card.className='card pop';
        card.innerHTML = `<h4>Soal ${idx+1}</h4><p>${q.q}</p>`;
        q.options.forEach((opt,oIdx)=>{
          const btn = document.createElement('div'); btn.className='quiz-option'; btn.tabIndex = 0;
          btn.textContent = String.fromCharCode(65+oIdx) + '. ' + opt;
          btn.onclick = ()=>{ userAnswers[idx]=oIdx; Array.from(card.querySelectorAll('.quiz-option')).forEach(b=>b.style.opacity=0.7); btn.style.opacity=1; };
          btn.onkeydown = (e)=> { if(e.key==='Enter' || e.key===' ') btn.click(); };
          card.appendChild(btn);
        });
        area.appendChild(card);
      });
      document.getElementById('quiz-result').innerHTML='';
    }

    function checkAnswers(){
      const unanswered = userAnswers.filter(x=>x===null).length;
      if(unanswered>0){ alert('Ada '+unanswered+' soal belum dijawab.'); return; }
      let score=0; const area=document.getElementById('quiz-area');
      quizData.forEach((q,idx)=>{
        const card = area.children[idx]; const opts = card.querySelectorAll('.quiz-option');
        opts.forEach((optEl,oIdx)=>{
          optEl.style.pointerEvents='none';
          if(oIdx===q.a) optEl.classList.add('correct');
          if(userAnswers[idx]===oIdx && userAnswers[idx]!==q.a) optEl.classList.add('wrong');
        });
        if(userAnswers[idx]===q.a) score++;
      });
      const percent = Math.round((score/quizData.length)*100);
      document.getElementById('quiz-result').innerHTML = `<div class="result-badge"><strong>Skor: ${score}/${quizData.length} (${percent}%)</strong></div>`;
      playTone(percent>=70? 'success':'fail');
      // small confetti-like pulse
      const badge = document.querySelector('.result-badge');
      if(badge){ badge.classList.add('pop'); setTimeout(()=> badge.classList.remove('pop'), 700); }
    }

    function resetQuiz(){ userAnswers = Array(quizData.length).fill(null); renderQuiz(); }

    /* --- Audio: WebAudio tones + SpeechSynthesis --- */
    const audioCtx = (typeof AudioContext !== 'undefined') ? new (window.AudioContext || window.webkitAudioContext)() : null;
    function playTone(type){
      if(!audioCtx) return;
      try {
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination);
        o.type='sine'; o.frequency.value = type==='success'?880: (type==='fail'?220:440);
        g.gain.setValueAtTime(0.0001,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.18,audioCtx.currentTime+0.02);
        o.start(); setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.02); o.stop(audioCtx.currentTime+0.03); }, 320);
      } catch(e){ /* ignore */ }
    }
    function speak(text){
      try {
        if('speechSynthesis' in window){
          const utter = new SpeechSynthesisUtterance(text);
          utter.lang='id-ID';
          speechSynthesis.cancel();
          speechSynthesis.speak(utter);
        }
      } catch(e){ /* ignore */ }
    }
    function playAudio(id){
      if(id==='intro'){
        speak('Halo adik adik! Ini ringkasan bab satu tentang jati diri. Jati diri berarti mengenal siapa dirimu, apa yang kamu sukai, dan apa yang bisa kamu lakukan. Yuk belajar bersama!');
      } else if(id==='bab1'){
        speak('Bab satu membahas pengertian jati diri, pentingnya jati diri positif, dan proses pembentukan jati diri pada anak usia dini.');
      }
    }

    // download
    function downloadPDF(){ window.location = '/mnt/data/Jati_diri_BG_Paud.pdf'; }

    /* =========================
       LATIHAN INTERAKTIF LOGIC
       ========================= */

    // --- helper state ---
    let interactiveState = {
      dndMap: {},               // map target -> id
      usedItems: new Set(),     // set of data-id that already used
      matchedPairs: new Set(),  // set of pair ids matched
      chosenEmoji: null
    };

    // expected emoji for correctness (simple demo)
    const correctEmoji = 'ðŸ˜Š';

    // detect webview (simple heuristic)
    const isWebView = /wv|webview|Android.*;.*Version\/.*Chrome/.test(navigator.userAgent.toLowerCase()) || !!(window.ReactNativeWebView);

    // init drag & drop handlers (re-attach safe)
    function initDragDrop() {
      // If mobile or webview -> use tap based fallback: enable click selection on pool items
      if(window.innerWidth <= 920 || isWebView){
        // Add pointer cursor and click handlers; but don't break desktop drag support
        document.querySelectorAll('.dnd-item').forEach(item=>{
          item.classList.add('mobile-only-dnd');
          item.removeEventListener('dragstart', onDragStart);
          item.removeEventListener('dragend', onDragEnd);
          item.onclick = () => { selectMobileItem(item); };
        });
        // targets clickable
        document.querySelectorAll('.dnd-target').forEach(t=>{
          t.onclick = ()=> placeMobileSelected(t);
          if(!t.dataset.original) t.dataset.original = t.innerHTML;
        });
      } else {
        // Desktop: full drag & drop
        document.querySelectorAll('.dnd-item').forEach(item=>{
          item.setAttribute('draggable','true');
          item.style.opacity = '1';
          item.onclick = null;
          item.addEventListener('dragstart', onDragStart);
          item.addEventListener('dragend', onDragEnd);
        });
        document.querySelectorAll('.dnd-target').forEach(t=>{
          if(!t.dataset.original) t.dataset.original = t.innerHTML;
          t.classList.remove('filled','wrong');
          t.dataset.filled = t.dataset.filled || '';
          t.addEventListener('dragover', e=>e.preventDefault());
          t.removeEventListener('drop', onDrop); // remove in case
          t.addEventListener('drop', onDrop);
        });
      }
    }

    // Desktop DnD handlers
    function onDragStart(e){
      const id = e.target.dataset.id;
      if(interactiveState.usedItems.has(id)){ e.preventDefault(); return; }
      e.dataTransfer.setData('text/plain', id);
      setTimeout(()=> { if(e.target) e.target.classList.add('dragging'); }, 10);
    }
    function onDragEnd(e){ if(e.target) e.target.classList.remove('dragging'); }
    function onDrop(e){
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      const target = e.currentTarget;
      const accept = target.dataset.accept;
      // if already correct do nothing
      if(target.dataset.filled === id) return;
      if(id !== accept) {
        target.classList.add('wrong'); playTone('fail');
        setTimeout(()=> target.classList.remove('wrong'), 600); return;
      }
      // free prev if any
      if(target.dataset.filled){
        const prev = target.dataset.filled;
        interactiveState.usedItems.delete(prev);
        const prevItem = document.querySelector(`.dnd-item[data-id="${prev}"]`);
        if(prevItem){ prevItem.classList.remove('used'); prevItem.setAttribute('draggable','true'); }
      }
      target.dataset.filled = id;
      target.classList.add('filled');
      target.innerHTML = `<strong>âœ“</strong> ${target.dataset.original || target.innerHTML}`;
      interactiveState.usedItems.add(id);
      const poolItem = document.querySelector(`.dnd-item[data-id="${id}"]`);
      if(poolItem){ poolItem.classList.add('used'); poolItem.setAttribute('draggable','false'); }
      playTone('success');
    }

    // Mobile DnD (tap based)
    let mobileSelected = null;
    function selectMobileItem(el){
      // toggle selection
      if(mobileSelected && mobileSelected === el){ mobileSelected.classList.remove('selected'); mobileSelected = null; return; }
      if(mobileSelected) mobileSelected.classList.remove('selected');
      mobileSelected = el;
      mobileSelected.classList.add('selected');
      // announce
      try { speak('Dipilih '+ el.innerText); } catch(e){}
    }
    function placeMobileSelected(target){
      if(!mobileSelected) { speak('Pilih item dulu'); return; }
      const id = mobileSelected.dataset.id;
      const accept = target.dataset.accept;
      if(id !== accept){
        target.classList.add('wrong'); playTone('fail'); setTimeout(()=> target.classList.remove('wrong'),600);
        speak('Salah tempat');
        return;
      }
      // accept
      target.dataset.filled = id;
      target.classList.add('filled');
      target.innerHTML = `<strong>âœ“</strong> ${target.dataset.original || target.innerHTML}`;
      mobileSelected.classList.add('used'); mobileSelected.classList.remove('selected'); mobileSelected.onclick = null;
      interactiveState.usedItems.add(id);
      mobileSelected = null;
      playTone('success');
      speak('Betul');
    }

    // allow dropping back to pool for desktop
    function onPoolDrop(e){
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      const target = Array.from(document.querySelectorAll('.dnd-target')).find(t => t.dataset.filled === id);
      if(!target) return;
      target.dataset.filled = '';
      target.classList.remove('filled','wrong');
      target.innerHTML = target.dataset.original || target.innerHTML;
      interactiveState.usedItems.delete(id);
      const poolItem = document.querySelector(`.dnd-item[data-id="${id}"]`);
      if(poolItem){ poolItem.classList.remove('used'); poolItem.setAttribute('draggable','true'); }
      playTone('success');
    }

    // Matching cards logic
    let selectedCard = null;
    function initMatching(){
      interactiveState.matchedPairs = new Set();
      document.querySelectorAll('#match-cards .card-front').forEach(card=>{
        card.classList.remove('matched','selected');
        card.style.border = '2px solid transparent';
        card.style.opacity = 1;
        // restore original inner if removed
        if(card.dataset.original) card.innerHTML = card.dataset.original;
        // remove & re-attach to avoid duplicate listeners
        const clone = card.cloneNode(true);
        card.parentNode.replaceChild(clone, card);
      });

      // re-select nodes after clone
      document.querySelectorAll('#match-cards .card-front').forEach(card=>{
        // store original content
        if(!card.dataset.original) card.dataset.original = card.innerHTML;
        card.addEventListener('click', ()=>{
          if(card.classList.contains('matched')) return;
          if(!selectedCard){
            selectedCard = card;
            card.classList.add('selected');
            return;
          }
          if(selectedCard === card){ selectedCard.classList.remove('selected'); selectedCard = null; return; }
          // check
          const p1 = selectedCard.dataset.pair;
          const p2 = card.dataset.pair;
          if(p1 === p2){
            selectedCard.classList.add('matched');
            card.classList.add('matched');
            selectedCard.classList.remove('selected');
            interactiveState.matchedPairs.add(p1);
            playTone('success');
            speak('Pasangan cocok');
          } else {
            selectedCard.style.border = '2px solid #ef5350';
            card.style.border = '2px solid #ef5350';
            playTone('fail');
            setTimeout(()=> {
              if(!selectedCard.classList.contains('matched')) selectedCard.style.border = '2px solid transparent';
              if(!card.classList.contains('matched')) card.style.border = '2px solid transparent';
            }, 500);
            selectedCard.classList.remove('selected');
          }
          selectedCard = null;
        }, false);
      });
    }

    // Emoji select
    function selectEmoji(e){
      interactiveState.chosenEmoji = e;
      document.getElementById('interactive-result').innerHTML = `<div class="result-badge">Kamu memilih: <strong>${e}</strong></div>`;
      playTone('success');
      speak('Kamu memilih ' + e);
    }

    // Check interactive answers (scoring)
    function checkInteractive(){
      let score = 0;
      const total = 3;

      // 1) dnd: proportion correct
      const targets = Array.from(document.querySelectorAll('.dnd-target'));
      let correctDnd = 0;
      targets.forEach(t=>{
        if(t.dataset.filled && t.dataset.filled === t.dataset.accept) correctDnd++;
      });
      const dndScore = Math.round((correctDnd / targets.length) * 1);
      score += dndScore;

      // 2) matching: matched pairs / total pairs
      const totalPairs = (new Set(Array.from(document.querySelectorAll('#match-cards .card-front')).map(c=>c.dataset.pair))).size;
      const matchedCount = interactiveState.matchedPairs.size;
      const matchScore = Math.round((matchedCount / totalPairs) * 1);
      score += matchScore;

      // 3) emoji
      const emojiScore = (interactiveState.chosenEmoji === correctEmoji) ? 1 : 0;
      score += emojiScore;

      // display
      const percent = Math.round((score / total) * 100);
      const badgeNode = document.getElementById('interactive-result');
      badgeNode.innerHTML = `<div class="result-badge"><strong>Skor Interaktif: ${score}/${total} (${percent}%)</strong></div>`;
      playTone(percent >= 70 ? 'success' : 'fail');
      // feedback speech
      if(percent >= 70) speak('Bagus! Skor kamu ' + percent + ' persen');
      else speak('Coba lagi, latih terus ya!');
    }

    // Reset interactive
    function resetInteractive(){
      interactiveState = { dndMap: {}, usedItems: new Set(), matchedPairs: new Set(), chosenEmoji: null };
      // rebuild dnd pool (keep original order)
      const pool = document.getElementById('dnd-pool');
      pool.innerHTML = `
        <div class="dnd-item" draggable="true" data-id="nama" tabindex="0">Nama</div>
        <div class="dnd-item" draggable="true" data-id="umur" tabindex="0">Umur</div>
        <div class="dnd-item" draggable="true" data-id="kesukaan" tabindex="0">Kesukaan</div>
        <div class="dnd-item" draggable="true" data-id="kemampuan" tabindex="0">Kemampuan</div>
      `;
      // reset targets
      document.querySelectorAll('.dnd-target').forEach(t=>{
        t.dataset.filled = '';
        t.classList.remove('filled','wrong');
        t.innerHTML = t.dataset.original || t.innerHTML;
      });

      // reset matching cards
      const cardsWrap = document.getElementById('match-cards');
      cardsWrap.innerHTML = `
        <div class="card-front" data-pair="anak" data-original="ðŸ§’ Anak">ðŸ§’<div>Emoji: Anak</div></div>
        <div class="card-front" data-pair="anak" data-original="Anak">Anak<div style="font-size:10px;color:#777">Kata</div></div>
        <div class="card-front" data-pair="bola" data-original="âš½ Bola">âš½<div>Emoji: Bola</div></div>
        <div class="card-front" data-pair="bola" data-original="Bola">Bola<div style="font-size:10px;color:#777">Kata</div></div>
      `;

      // reset emoji result
      document.getElementById('interactive-result').innerHTML = '';
      selectedCard = null;
      mobileSelected = null;

      // re-init handlers
      initDragDrop();
      initMatching();
      playTone('success');
    }

    // Export HTML
    function exportHTML(){
      const doc = '<!doctype html>\n' + document.documentElement.outerHTML;
      const blob = new Blob([doc], {type: "text/html"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "paud_jatidiri_app.html";
      a.click();
      URL.revokeObjectURL(url);
    }

    // helper to open initial overview
    document.addEventListener('DOMContentLoaded', ()=>{
      // default show overview
      showSection('overview');
      // render quiz
      renderQuiz();
      // init interactive widgets
      initDragDrop();
      initMatching();

      // if webview or small, show mobile menu collapsed by default
      if(window.innerWidth <= 920 || isWebView) {
        document.getElementById('sidebar').classList.remove('active');
      }
      // attach pool drop for desktop
      const pool = document.getElementById('dnd-pool');
      if(pool){
        pool.addEventListener('dragover', e=>e.preventDefault());
        pool.addEventListener('drop', onPoolDrop);
      }
    });

    // small keyboard support for accessibility (enter to pick place)
    document.addEventListener('keyup', function(e){
      if(e.key === 'Escape'){
        // clear selection
        if(mobileSelected){ mobileSelected.classList.remove('selected'); mobileSelected = null; }
        if(selectedCard){ selectedCard.classList.remove('selected'); selectedCard = null; }
      }
    });

    // Click-to-open sections from outside functions
    function openSection(name){
      // convenience when using external links
      document.querySelectorAll('.menu li').forEach(li => li.classList.remove('active'));
      const li = Array.from(document.querySelectorAll('.menu li')).find(x=>x.dataset.target===name);
      if(li) li.classList.add('active');
      showSection(name);
    }

  </script>
</body>
</html>
